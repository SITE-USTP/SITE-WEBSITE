---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/sections/Hero/Hero.astro";
import PostCard from "../components/cards/PostCard/PostCard.astro";
import EventCard from "../components/cards/EventCard/EventCard.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3);

const upcomingEvents = (await getCollection("events"))
	.filter((event) => event.data.status === "Upcoming")
	.sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf())
	.slice(0, 3);
---

<Layout title="Home">
	<Hero />

	<section class="py-16">
		<div class="container mx-auto px-4">
			<div class="flex justify-between items-end mb-12">
				<div>
					<h2 class="text-3xl font-bold mb-2">
						Latest from the Blog
					</h2>
					<p class="text-gray-400">
						Insights, tutorials, and updates from our community.
					</p>
				</div>
				<a
					href="/blog"
					class="text-[var(--color-primary)] hover:underline font-mono"
					>View all posts &rarr;</a
				>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
				{posts.map((post) => <PostCard post={post} />)}
			</div>
		</div>
	</section>

	<section class="py-16">
		<div class="container mx-auto px-4">
			<div class="flex justify-between items-end mb-12">
				<div>
					<h2 class="text-3xl font-bold mb-2">Upcoming Events</h2>
					<p class="text-gray-400">
						Join us for workshops, hackathons, and meetups.
					</p>
				</div>
				<a
					href="/events"
					class="text-[var(--color-primary)] hover:underline font-mono"
					>View calendar &rarr;</a
				>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{
					upcomingEvents.length > 0 ? (
						upcomingEvents.map((event) => (
							<EventCard event={event} />
						))
					) : (
						<div class="col-span-full text-center py-8 text-gray-500 border border-dashed border-gray-700 rounded-lg">
							<p>
								No upcoming events scheduled. Check back soon!
							</p>
						</div>
					)
				}
			</div>
		</div>
	</section>
</Layout>
